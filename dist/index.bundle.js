(()=>{"use strict";const e=JSON.parse('[{"bin":"chip8-roms/demos/Maze (alt) [David Winter, 199x].ch8","txt":true},{"bin":"chip8-roms/demos/Maze [David Winter, 199x].ch8","txt":true},{"bin":"chip8-roms/demos/Particle Demo [zeroZshadow, 2008].ch8","txt":true},{"bin":"chip8-roms/demos/Sierpinski [Sergey Naydenov, 2010].ch8","txt":false},{"bin":"chip8-roms/demos/Sirpinski [Sergey Naydenov, 2010].ch8","txt":false},{"bin":"chip8-roms/demos/Stars [Sergey Naydenov, 2010].ch8","txt":false},{"bin":"chip8-roms/demos/Trip8 Demo (2008) [Revival Studios].ch8","txt":true},{"bin":"chip8-roms/demos/Zero Demo [zeroZshadow, 2007].ch8","txt":true},{"bin":"chip8-roms/games/15 Puzzle [Roger Ivie] (alt).ch8","txt":false},{"bin":"chip8-roms/games/15 Puzzle [Roger Ivie].ch8","txt":true},{"bin":"chip8-roms/games/Addition Problems [Paul C. Moews].ch8","txt":false},{"bin":"chip8-roms/games/Airplane.ch8","txt":false},{"bin":"chip8-roms/games/Animal Race [Brian Astle].ch8","txt":true},{"bin":"chip8-roms/games/Astro Dodge [Revival Studios, 2008].ch8","txt":true},{"bin":"chip8-roms/games/Biorhythm [Jef Winsor].ch8","txt":true},{"bin":"chip8-roms/games/Blinky [Hans Christian Egeberg, 1991].ch8","txt":false},{"bin":"chip8-roms/games/Blinky [Hans Christian Egeberg] (alt).ch8","txt":false},{"bin":"chip8-roms/games/Blitz [David Winter].ch8","txt":true},{"bin":"chip8-roms/games/Bowling [Gooitzen van der Wal].ch8","txt":true},{"bin":"chip8-roms/games/Breakout (Brix hack) [David Winter, 1997].ch8","txt":true},{"bin":"chip8-roms/games/Breakout [Carmelo Cortez, 1979].ch8","txt":true},{"bin":"chip8-roms/games/Brick (Brix hack, 1990).ch8","txt":true},{"bin":"chip8-roms/games/Brix [Andreas Gustafsson, 1990].ch8","txt":false},{"bin":"chip8-roms/games/Cave.ch8","txt":false},{"bin":"chip8-roms/games/Coin Flipping [Carmelo Cortez, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Connect 4 [David Winter].ch8","txt":true},{"bin":"chip8-roms/games/Craps [Camerlo Cortez, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Deflection [John Fort].ch8","txt":true},{"bin":"chip8-roms/games/Figures.ch8","txt":false},{"bin":"chip8-roms/games/Filter.ch8","txt":false},{"bin":"chip8-roms/games/Guess [David Winter] (alt).ch8","txt":true},{"bin":"chip8-roms/games/Guess [David Winter].ch8","txt":true},{"bin":"chip8-roms/games/Hi-Lo [Jef Winsor, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Hidden [David Winter, 1996].ch8","txt":true},{"bin":"chip8-roms/games/Kaleidoscope [Joseph Weisbecker, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Landing.ch8","txt":false},{"bin":"chip8-roms/games/Lunar Lander (Udo Pernisz, 1979).ch8","txt":false},{"bin":"chip8-roms/games/Mastermind FourRow (Robert Lindley, 1978).ch8","txt":true},{"bin":"chip8-roms/games/Merlin [David Winter].ch8","txt":true},{"bin":"chip8-roms/games/Missile [David Winter].ch8","txt":false},{"bin":"chip8-roms/games/Most Dangerous Game [Peter Maruhnic].ch8","txt":true},{"bin":"chip8-roms/games/Nim [Carmelo Cortez, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Paddles.ch8","txt":false},{"bin":"chip8-roms/games/Pong (1 player).ch8","txt":false},{"bin":"chip8-roms/games/Pong (alt).ch8","txt":false},{"bin":"chip8-roms/games/Pong 2 (Pong hack) [David Winter, 1997].ch8","txt":false},{"bin":"chip8-roms/games/Pong [Paul Vervalin, 1990].ch8","txt":true},{"bin":"chip8-roms/games/Programmable Spacefighters [Jef Winsor].ch8","txt":true},{"bin":"chip8-roms/games/Puzzle.ch8","txt":false},{"bin":"chip8-roms/games/Reversi [Philip Baltzer].ch8","txt":true},{"bin":"chip8-roms/games/Rocket Launch [Jonas Lindstedt].ch8","txt":false},{"bin":"chip8-roms/games/Rocket Launcher.ch8","txt":false},{"bin":"chip8-roms/games/Rocket [Joseph Weisbecker, 1978].ch8","txt":false},{"bin":"chip8-roms/games/Rush Hour [Hap, 2006] (alt).ch8","txt":false},{"bin":"chip8-roms/games/Rush Hour [Hap, 2006].ch8","txt":true},{"bin":"chip8-roms/games/Russian Roulette [Carmelo Cortez, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Sequence Shoot [Joyce Weisbecker].ch8","txt":true},{"bin":"chip8-roms/games/Shooting Stars [Philip Baltzer, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Slide [Joyce Weisbecker].ch8","txt":true},{"bin":"chip8-roms/games/Soccer.ch8","txt":false},{"bin":"chip8-roms/games/Space Flight.ch8","txt":false},{"bin":"chip8-roms/games/Space Intercept [Joseph Weisbecker, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Space Invaders [David Winter] (alt).ch8","txt":true},{"bin":"chip8-roms/games/Space Invaders [David Winter].ch8","txt":true},{"bin":"chip8-roms/games/Spooky Spot [Joseph Weisbecker, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Squash [David Winter].ch8","txt":false},{"bin":"chip8-roms/games/Submarine [Carmelo Cortez, 1978].ch8","txt":true},{"bin":"chip8-roms/games/Sum Fun [Joyce Weisbecker].ch8","txt":true},{"bin":"chip8-roms/games/Syzygy [Roy Trevino, 1990].ch8","txt":true},{"bin":"chip8-roms/games/Tank.ch8","txt":true},{"bin":"chip8-roms/games/Tapeworm [JDR, 1999].ch8","txt":false},{"bin":"chip8-roms/games/Tetris [Fran Dachille, 1991].ch8","txt":true},{"bin":"chip8-roms/games/Tic-Tac-Toe [David Winter].ch8","txt":false},{"bin":"chip8-roms/games/Timebomb.ch8","txt":false},{"bin":"chip8-roms/games/Tron.ch8","txt":false},{"bin":"chip8-roms/games/UFO [Lutz V, 1992].ch8","txt":true},{"bin":"chip8-roms/games/Vers [JMN, 1991].ch8","txt":false},{"bin":"chip8-roms/games/Vertical Brix [Paul Robson, 1996].ch8","txt":false},{"bin":"chip8-roms/games/Wall [David Winter].ch8","txt":false},{"bin":"chip8-roms/games/Wipe Off [Joseph Weisbecker].ch8","txt":false},{"bin":"chip8-roms/games/Worm V4 [RB-Revival Studios, 2007].ch8","txt":true},{"bin":"chip8-roms/games/X-Mirror.ch8","txt":false},{"bin":"chip8-roms/games/ZeroPong [zeroZshadow, 2007].ch8","txt":false},{"bin":"chip8-roms/hires/Astro Dodge Hires [Revival Studios, 2008].ch8","txt":true},{"bin":"chip8-roms/hires/Hires Maze [David Winter, 199x].ch8","txt":true},{"bin":"chip8-roms/hires/Hires Particle Demo [zeroZshadow, 2008].ch8","txt":true},{"bin":"chip8-roms/hires/Hires Sierpinski [Sergey Naydenov, 2010].ch8","txt":false},{"bin":"chip8-roms/hires/Hires Stars [Sergey Naydenov, 2010].ch8","txt":false},{"bin":"chip8-roms/hires/Hires Test [Tom Swan, 1979].ch8","txt":false},{"bin":"chip8-roms/hires/Hires Worm V4 [RB-Revival Studios, 2007].ch8","txt":true},{"bin":"chip8-roms/hires/Trip8 Hires Demo (2008) [Revival Studios].ch8","txt":true},{"bin":"chip8-roms/programs/BMP Viewer - Hello (C8 example) [Hap, 2005].ch8","txt":true},{"bin":"chip8-roms/programs/Chip8 Picture.ch8","txt":false},{"bin":"chip8-roms/programs/Chip8 emulator Logo [Garstyciuks].ch8","txt":false},{"bin":"chip8-roms/programs/Clock Program [Bill Fisher, 1981].ch8","txt":true},{"bin":"chip8-roms/programs/Delay Timer Test [Matthew Mikolay, 2010].ch8","txt":true},{"bin":"chip8-roms/programs/Division Test [Sergey Naydenov, 2010].ch8","txt":false},{"bin":"chip8-roms/programs/Fishie [Hap, 2005].ch8","txt":true},{"bin":"chip8-roms/programs/Framed MK1 [GV Samways, 1980].ch8","txt":true},{"bin":"chip8-roms/programs/Framed MK2 [GV Samways, 1980].ch8","txt":true},{"bin":"chip8-roms/programs/IBM Logo.ch8","txt":false},{"bin":"chip8-roms/programs/Jumping X and O [Harry Kleinberg, 1977].ch8","txt":true},{"bin":"chip8-roms/programs/Keypad Test [Hap, 2006].ch8","txt":true},{"bin":"chip8-roms/programs/Life [GV Samways, 1980].ch8","txt":true},{"bin":"chip8-roms/programs/Minimal game [Revival Studios, 2007].ch8","txt":false},{"bin":"chip8-roms/programs/Random Number Test [Matthew Mikolay, 2010].ch8","txt":true},{"bin":"chip8-roms/programs/SQRT Test [Sergey Naydenov, 2010].ch8","txt":false}]');function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.height=i,this.width=t,this.canvas=r,this.canvas.width=16*t,this.canvas.height=16*i,this.canvas.style.imageRendering="pixelated",this.ctx=r.getContext("2d"),this.pixels=new Uint8Array(i*t),this.clear()}var i,r;return i=e,(r=[{key:"get",value:function(e,t){var i=t*this.width+e;return!!this.pixels[i]}},{key:"toggle",value:function(e,t){var i=t*this.width+e;i<this.pixels.length&&(this.pixels[i]^=1)}},{key:"clear",value:function(){for(var e=0;e<this.pixels.length;e++)this.pixels[e]=0}},{key:"getLines",value:function(e,t,i){for(var r=t.split(" "),s=[],n=r[0],a=1;a<r.length;a++){var c=r[a];e.measureText(n+" "+c).width<i?n+=" "+c:(s.push(n),n=c)}return s.push(n),s}},{key:"renderFailure",value:function(e){var t=this.canvas,i=this.ctx,r=t.width/2,s=t.height/2;i.fillStyle="black",i.fillRect(0,0,t.width,t.height),i.font="16px monospace",i.fillStyle="red",i.textAlign="center",i.fillText("The emulator aborted with the following error :(",r,s),s+=16,this.getLines(i,e.message,t.width-10).forEach((function(e){i.textBaseline="top",i.fillText(e,r,s),s+=20}))}},{key:"renderPaused",value:function(){var e=this.canvas,t=this.ctx,i=e.width/2,r=e.height/2;this.render(!0),t.font="30px sans-serif",t.filter="none",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText("Emulator is paused. Press Esc to unpause",i,r)}},{key:"renderPixel",value:function(e,t){e*=16,t*=16,this.ctx.fillRect(e+1,t+1,14,14)}},{key:"render",value:function(e){var t=this.ctx;t.fillStyle="black",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=e?"rgba(255, 255, 255, 0.5)":"white",e&&(t.filter="blur(4px)");for(var i=0;i<this.height;i++)for(var r=0;r<this.width;r++)this.get(r,i)&&this.renderPixel(r,i)}}])&&t(i.prototype,r),e}(),r=function(e){for(var t=e.toString(16).toUpperCase();t.length<4;)t="0"+t;return"0x"+t};function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t,this.chip=i}var t,i;return t=e,(i=[{key:"doNothing",value:function(){this.chip.pc+=2}},{key:"clear",value:function(){this.chip.screen.clear(),this.chip.pc+=2,this.chip.screenChanged=!0}},{key:"returnFromSubroutine",value:function(){var e=this.chip;e.pc=e.stack[--e.sp]+2}},{key:"jump",value:function(e){this.chip.pc!==e?this.chip.pc=e:this.chip.halted=!0}},{key:"callSubroutine",value:function(e){var t=this.chip;if(t.sp>=t.stack.length)throw new Error("Could not enter a subroutine at "+r(e)+"from PC "+r(t.pc)+"because the stack is full.");t.stack[t.sp++]=t.pc,t.pc=e}},{key:"skipIfRegisterEquals",value:function(e,t){var i=this.chip;this.chip.registers[e]===t?i.pc+=4:i.pc+=2}},{key:"skipIfRegisterNotEquals",value:function(e,t){var i=this.chip;this.chip.registers[e]!==t?i.pc+=4:i.pc+=2}},{key:"skipIfRegistersEqual",value:function(e,t){var i=this.chip,r=this.chip.registers;r[e]===r[t]?i.pc+=4:i.pc+=2}},{key:"setRegisterValue",value:function(e,t){var i=this.chip;this.code,i.registers[e]=t,i.pc+=2}},{key:"addToRegisterValue",value:function(e,t){var i=this.chip;this.code,i.registers[e]+=t,i.pc+=2}},{key:"assign",value:function(e,t){var i=this.chip,r=this.chip.registers;r[e]=r[t],i.pc+=2}},{key:"bitwiseOr",value:function(e,t){var i=this.chip,r=this.chip.registers;r[e]=r[e]|r[t],i.pc+=2}},{key:"bitwiseAnd",value:function(e,t){var i=this.chip,r=this.chip.registers;r[e]=r[e]&r[t],i.pc+=2}},{key:"bitwiseXor",value:function(e,t){var i=this.chip,r=this.chip.registers;r[e]=r[e]^r[t],i.pc+=2}},{key:"add",value:function(e,t){var i=this.chip,r=this.chip.registers,s=r[e]+r[t];r[15]=s>255,r[e]=s,i.pc+=2}},{key:"subtract",value:function(e,t){var i=this.chip,r=this.chip.registers;r[15]=r[e]>=r[t],r[e]-=r[t],i.pc+=2}},{key:"shiftRight",value:function(e,t){var i=this.chip,r=this.chip.registers;r[15]=1&r[e],r[e]>>=1,i.pc+=2}},{key:"subtractRegisters",value:function(e,t){var i=this.chip,r=this.chip.registers;r[15]=r[t]>=r[e],r[e]=r[t]-r[e],i.pc+=2}},{key:"shiftLeft",value:function(e,t){var i=this.chip,r=this.chip.registers,s=128&r[e];r[15]=s>0,r[e]<<=1,i.pc+=2}},{key:"skipIfRegistersNotEqual",value:function(e,t){var i=this.chip,r=this.chip.registers;r[e]!==r[t]?i.pc+=4:i.pc+=2}},{key:"setMemoryRegister",value:function(e){this.chip.registerI=e,this.chip.pc+=2}},{key:"jumpV0",value:function(e){this.chip.pc=this.chip.registers[0]+e}},{key:"rand",value:function(e,t){var i=Math.floor(256*Math.random());this.chip.registers[e]=i&t,this.chip.pc+=2}},{key:"draw",value:function(e,t,i){var r=this.chip,s=this.chip,n=s.registers,a=s.screen,c=n[e],o=n[t];n[15]=0;for(var h=0;h<i&&o+h<a.height;h++)for(var u=r.memory[r.registerI+h],l=0;l<8;l++)if((u&128>>l)>0){var p=c+l,m=o+h;a.get(p,m)&&(n[15]=1),a.toggle(p,m)}r.pc+=2,r.screenChanged=!0}},{key:"skipIfKeyPressed",value:function(e){var t=this.chip,i=t.registers[e];t.keyboard[i]?t.pc+=4:t.pc+=2}},{key:"skipIfKeyNotPressed",value:function(e){var t=this.chip,i=t.registers[e];t.keyboard[i]?t.pc+=2:t.pc+=4}},{key:"getDelayTimer",value:function(e){var t=this.chip;t.registers[e]=t.delayTimer,t.pc+=2}},{key:"awaitKeyPress",value:function(e){var t=this.chip;t.halted=!0,t.onNextKeyDown=function(i){t.registers[e]=i,t.halted=!1,t.pc+=2}}},{key:"setDelayTimer",value:function(e){var t=this.chip;t.delayTimer=t.registers[e],t.pc+=2}},{key:"setSoundTimer",value:function(e){var t=this.chip;t.soundTimer=t.registers[e],t.pc+=2}},{key:"addMem",value:function(e){var t=this.chip;t.registerI+=t.registers[e],t.registerI&=65535,t.pc+=2}},{key:"setCharacterInMemory",value:function(e){var t=this.chip;t.registerI=5*t.registers[e],t.pc+=2}},{key:"storeBCD",value:function(e){var t=this.chip,i=t.registers[e],r=t.registerI;t.memory[r+0]=i/100,t.memory[r+1]=i%100/10,t.memory[r+2]=i%10,t.pc+=2}},{key:"dumpRegisters",value:function(e){for(var t=this.chip,i=0;i<=e;i++)t.memory[t.registerI+i]=t.registers[i];t.pc+=2}},{key:"loadRegisters",value:function(e){for(var t=this.chip,i=0;i<=e;i++)t.registers[i]=t.memory[t.registerI+i];t.pc+=2}},{key:"decode",value:function(){var e=this.code;switch(61440&e){case 0:switch(255&e){case 224:return["clear"];case 238:return["returnFromSubroutine"];default:return["doNothing"]}case 4096:return["jump","NNN"];case 8192:return["callSubroutine","NNN"];case 12288:return["skipIfRegisterEquals","X","NN"];case 16384:return["skipIfRegisterNotEquals","X","NN"];case 20480:return["skipIfRegistersEqual","X","Y"];case 24576:return["setRegisterValue","X","NN"];case 28672:return["addToRegisterValue","X","NN"];case 32768:switch(15&e){case 0:return["assign","X","Y"];case 1:return["bitwiseOr","X","Y"];case 2:return["bitwiseAnd","X","Y"];case 3:return["bitwiseXor","X","Y"];case 4:return["add","X","Y"];case 5:return["subtract","X","Y"];case 6:return["shiftRight","X","Y"];case 7:return["subtractRegisters","X","Y"];case 14:return["shiftLeft","X","Y"]}case 36864:return["skipIfRegistersNotEqual","X","Y"];case 40960:return["setMemoryRegister","NNN"];case 45056:return["jumpV0","NNN"];case 49152:return["rand","X","NN"];case 53248:return["draw","X","Y","N"];case 57344:switch(255&e){case 158:return["skipIfKeyPressed","X"];case 161:return["skipIfKeyNotPressed","X"]}case 61440:switch(255&e){case 7:return["getDelayTimer","X"];case 10:return["awaitKeyPress","X"];case 21:return["setDelayTimer","X"];case 24:return["setSoundTimer","X"];case 30:return["addMem","X"];case 41:return["setCharacterInMemory","X"];case 51:return["storeBCD","X"];case 85:return["dumpRegisters","X"];case 101:return["loadRegisters","X"]}}throw new Error("Unknown instruction: "+r(e)+". At PC "+this.chip.pc)}},{key:"executable",value:function(){var e=this.decode(),t=e[0],i={N:15&this.code,NN:255&this.code,NNN:4095&this.code,X:(3840&this.code)>>8,Y:(240&this.code)>>4},r=e.slice(1);return{method:t,args:r.map((function(e){return i[e]})),argNames:r}}},{key:"execute",value:function(){this.chip.pc;try{var e=this.executable(),t=e.method,i=e.args;this[t].apply(this,i)}catch(e){throw console.error(e),new Error("Error executing instruction: ".concat(r(this.code)," (").concat(method,")"))}}}])&&s(t.prototype,i),e}();function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}for(var c=new(function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.querySelector(t.canvas),!this.canvas)throw new Error("Canvas not found:",t.canvas);this.loadRom=this.loadRom.bind(this),this.audioContext=new(AudioContext||webkitAudioContext)}var t,r;return t=e,(r=[{key:"loadFontSet",value:function(){for(var e=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],t=0;t<e.length;t++)this.memory[t]=e[t]}},{key:"init",value:function(){this.memory=new Uint8Array(4096),this.loadFontSet(),this.registers=new Uint8Array(16),this.registerI=0,this.pc=512,this.sp=0,this.halted=!0,this.paused=!1,this.screenChanged=!1,this.stack=new Uint16Array(16),this.delayTimer=0,this.soundTimer=0,this.screen=new i(64,32,this.canvas),this.keyboard=new Uint8Array(16),this.inited=!0}},{key:"visualizeMemory",value:function(){for(var e=this.memory,t=0;t<e.length;t+=2){var i=e[t]<<8|e[t+1];0!==i&&console.log(t.toString(16).toUpperCase(),i.toString(16).toUpperCase())}}},{key:"loadRom",value:function(e){if(e instanceof Uint8Array==0)throw new Error("loadRom requires a Uint8Array");if(e.length>3584)throw new Error("ROM too large.");for(var t=0;t<e.length;t++)this.memory[512+t]=e[t]}},{key:"loadRomFromFile",value:function(e){var t=this;return function(e){return new Promise((function(t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)try{var s=new Uint8Array(r.response);t(s)}catch(e){i(e)}else i(new Error(e+" does not exist"))},r.onerror=function(e){i(e)},r.send()}))}(e).then(this.loadRom).catch((function(e){throw t.screen.renderFailure(e),e}))}},{key:"fetchOpcode",value:function(){return this.memory[this.pc]<<8|this.memory[this.pc+1]}},{key:"executeInstruction",value:function(e){new n(e,this).execute()}},{key:"onKeyDown",value:function(e){if(this.keyboard){var t=parseInt(e,16);isNaN(t)||t>15||(this.keyboard[t]=1,this.onNextKeyDown instanceof Function&&(this.onNextKeyDown(t),this.onNextKeyDown=null,this.cycle()))}}},{key:"onKeyUp",value:function(e){if(this.keyboard){var t=parseInt(e,16);isNaN(t)||t>15||(this.keyboard[t]=0)}}},{key:"startBeeping",value:function(){if(!this.oscillator){var e=this.audioContext.createOscillator();e.type="square",e.frequency.value=440,e.connect(this.audioContext.destination),e.start(0),this.oscillator=e}}},{key:"stopBeeping",value:function(){this.oscillator&&(this.oscillator.stop(0),this.oscillator.disconnect(this.audioContext.destination),this.oscillator=null)}},{key:"cycle",value:function(){var e=this;if(!this.paused&&!this.halted){for(var t=0;t<10;t++){var i=this.fetchOpcode();try{this.executeInstruction(i)}catch(e){throw this.screen.renderFailure(e),e}}this.screenChanged&&(this.screen.render(),this.screenChanged=!1),this.updateTimers(),this.soundTimer>0?this.startBeeping():this.stopBeeping(),setTimeout((function(){e.cycle()}),1e3/60)}}},{key:"updateTimers",value:function(){this.delayTimer>0&&this.delayTimer--,this.soundTimer>0&&this.soundTimer--}},{key:"start",value:function(){if(!this.inited)return console.warn("Unitialized Chip");this.halted=!1,this.paused=!1,this.screen.render(),this.cycle()}},{key:"pause",value:function(){if(!this.inited)return console.warn("Unitialized Chip");this.paused=!0,this.stopBeeping(),this.screen.renderPaused()}}])&&a(t.prototype,r),e}())({canvas:"canvas",keyboard:"#keyboard"}),o=null,h=document.querySelectorAll(".button"),u=function(e){var t=h[e];t.onmousedown=function(){t.setAttribute("class","button active"),c.onKeyDown(t.innerText.trim()),o=t},t.onmouseup=function(){o=null,t.setAttribute("class","button"),c.onKeyUp(t.innerText.trim())}},l=0;l<h.length;l++)u(l);document.onmouseup=function(){null!==o&&o.onmouseup()};var p=document.querySelector("#roms"),m=document.querySelector("#instructions"),g={};e.forEach((function(e,t){var i=document.createElement("option"),r=e.bin.split("/"),s=r.pop(),n=r.pop(),a=s.slice(0,-4);i.value=t,i.innerHTML=a,g.hasOwnProperty(n)||(g[n]=[]),g[n].push(i)}));var f=function(e){var t=g[e],i=e[0].toUpperCase()+e.slice(1),r=document.createElement("optgroup");t.forEach((function(e){return r.appendChild(e)})),r.setAttribute("label",i),p.appendChild(r)};for(var d in g)f(d);p.onchange=function(){c.init();var t=this.value,i=e[t],r=i.bin,s=i.txt?i.bin.slice(0,-4)+".txt":null;if(c.loadRomFromFile(r).then((function(){c.start()})),s){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(m.innerHTML=n.responseText||"No instructions")},n.open("GET",s),n.overrideMimeType("text/plain; charset=utf-8"),n.send()}else m.innerHTML="No instructions"};var v=["x","1","2","3","q","w","e","a","s","d","z","c","4","r","f","v"];document.onkeydown=function(e){if(!(e.metaKey||e.ctrlKey||e.shiftKey)){var t=e.key,i=v.indexOf(t);if(i>-1){var r=i.toString(16).toUpperCase(),s=document.querySelector("[data-value='".concat(r,"']"));s&&s.onmousedown()}"Escape"===t&&(c.paused?c.start():c.pause())}},document.onkeyup=function(e){var t=e.key,i=v.indexOf(t);if(i>-1){var r=i.toString(16).toUpperCase(),s=document.querySelector("[data-value='".concat(r,"']"));s&&s.onmouseup()}},window.onblur=function(e){return c.pause()}})();